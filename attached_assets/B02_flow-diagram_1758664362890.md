graph TD
    subgraph System_Entry [Entry & Authentication]
        A[Start] --> B{Has Account?};
        B -->|No| B1["Sign Up Page"];
        B -->|Yes| B2["Login Page"];
        B1 --> C["Initiate Onboarding Flow"];
        B2 -->|Authenticated| D[Dashboard];
    end

    subgraph Onboarding_Flow [Onboarding]
        C --> C1["Step 1: Upload Materials"];
        C1 --> C2["Step 2: Voice/Text Narrative Input"];
        C2 --> C3["Trigger AI Profile Synthesis Job"];
        C3 --> C4["UI: Show Processing State"];
        C4 --> C5{AI Synthesis Result};
        C5 -->|OK| C6["Redirect to Settings for Full-Screen Review"];
        C5 -->|Failed| C7["UI: Show Error State w/ Retry"];
        C6 --> H;
    end

    subgraph Main_Hubs [Main Hubs]
        D --> E["Opportunity Hub"];
        D --> G["Applications Page"];
        D --> H["Settings Page"];
    end
    
    subgraph Settings_Management [Settings Page]
        H --> H1["View/Edit Master CV (Full Screen)"];
        H1 --> H2["User Reviews AI Confidence Flags"];
        H2 --> H3{Initial CV Approved?};
        H3 -->|Yes| D;
        H1 --> H4["Edit User Links (LinkedIn/Portfolio)"];
        H1 --> H5{User Tier?};
        H5 -->|Paid| H6["Enable 'Download Master CV'"];
        H5 -->|Free| H7["'Download Master CV' Disabled"];
    end

    subgraph Opportunity_Hub [Opportunity Hub]
        E --> E1{Select Tab};
        E1 -->|Search Tab| E2["Search Interface"];
        E1 -->|Saved Tab| E3["Display Saved Opportunities"];
        
        E2 --> E4{Input Method};
        E4 -->|Keyword Search| E5["Input: Keywords, Region, etc."];
        E4 -->|Auto-Search| E6["Action: Click 'Find Best Matches'"];
        E4 -->|Manual Input| E7["Action: Paste Job Ad Link/Text"];
        
        E5 --> E8["Execute Search"];
        E6 --> E8;
        
        E8 --> E9{User Tier?};
        E9 -->|Free| E10["Check Search Limit"];
        E10 -->|Limit OK| E11;
        E10 -->|Limit Exceeded| Monetization_Upgrade["Show Upgrade Modal"];
        
        E9 -->|Paid| E12["Display Advanced Filters"];
        E12 --> E11["Execute Search w/ Filters"];
        
        E11 --> E13["Display Strategic ListView of Results"];
        E13 --> E14{User Tier?};
        E14 -->|Free| E15["UI: Obfuscate Non-Top Results"];
        E14 -->|Paid| E16["UI: Show All Results"];

        E15 --> E17{User Interaction};
        E16 --> E17;
        E3 --> E17;

        E17 -->|Select via Checkbox| E18["UI: Show Action Bar"];
        E18 --> E19{Select Action};
        E19 -->|Save| E20["Add to Saved List"];
        E20 --> E3;
        E19 -->|Generate| AppGenTrigger["Trigger Application Generation"];
        
        E17 -->|"Click Row Details"| E21["UI: Display Job Synopsis"];
        
        E7 --> E22["Create Temp Opportunity from Input"];
        E22 --> AppGenTrigger;
    end

    subgraph Application_Generation [Application Generation]
        AppGenTrigger --> AG1{Check Credits/Limits};
        AG1 -->|"Limit Reached"| Monetization_Upgrade;
        AG1 -->|OK| AG2["Consume 1 Credit"];
        AG2 --> AG3["Trigger Async Generation Job"];
        AG3 --> AG4["UI: Show 'Processing' Toast"];
        AG4 --> G;
        
        subgraph AsyncJob ["Async: Application Pkg Gen"]
            direction LR
            J1[Started] --> J2["AI Generates Resume, Cover Letter & ATS Score"] --> J3[Complete];
        end
    end

    subgraph Applications_Page [Applications Page]
        G -->|"Populated by Async Job"| G1["Display New App Package in Card View"];
        G1 --> G2["Card Header Shows: Role, Company, Scores"];
        G1 --> G3{User Action on Card};
        G3 -->|Download| G4["Initiate PDF Download"];
        G3 -->|View Post| G5["Open Original Job Link"];
        G3 -->|"Edit/Refine"| W["Enter Application Workshop"];
    end
    
    subgraph Application_Workshop [Application Workshop]
        W --> W1["Display 3-Panel Layout (Nav | Editor | Context)"];
        W_Center["Center Panel: Document Editor"]
        W_Right["Right Panel: Job Info & Template Tools"]
        
        W1 --> W_Center;
        W1 --> W_Right;
        
        W_Center --> W2{User Action};
        W_Right --> W2;
        
        W2 -->|"Saves Edits"| W3["Persist Changes"];
        W2 -->|"Selects New Template"| W4["Apply Template to Document"];
        W2 -->|"Clicks Download"| G4;
    end